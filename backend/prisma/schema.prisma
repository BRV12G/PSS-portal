// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  auditLogs AuditLog[]

  @@map("admins")
}

model CommitteeMember {
  id          Int      @id @default(autoincrement())
  name        String
  designation String
  photoUrl    String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("committee_members")
}

model Announcement {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  photoUrl    String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("announcements")
}

model Event {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  date        DateTime
  photoUrl    String?
  location    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("events")
}

model CarouselImage {
  id        Int      @id @default(autoincrement())
  imageUrl  String
  altText   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())

  @@map("carousel_images")
}


model AuditLog {
  id         Int      @id @default(autoincrement())
  adminId    Int
  action     String   // CREATE, UPDATE, DELETE
  entity     String   // e.g. "Event", "Announcement"
  entityId   Int      // ID of the affected record
  oldData    Json?    // data before change
  newData    Json?    // data after change
  createdAt  DateTime @default(now())

  admin      Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
}


// polymorphic audit design for audit log that can handle multiple entities with a single table, we can use a JSON field to store the old and new data for any entity type. This way, we can log changes for any entity without needing separate audit tables for each entity type.